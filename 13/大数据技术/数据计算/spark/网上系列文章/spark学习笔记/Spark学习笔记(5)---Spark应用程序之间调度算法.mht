From: WizMime<support@wiz.cn>
Subject: =?gb2312?B?U3BhcmvRp8+wscq8xyg1KS0tLVNwYXJr06bTw7PM0PLWrrzktfe2yMvjt6g=?=
Date: Date: Fri, 23 Jul 2021 05:55:09 +0800
MIME-Version: 1.0
Content-Type: multipart/related;
	type="multipart/alternative";
	boundary="----=_Next_Part_0001369404.492"

This is a multi-part message in MIME format.

------=_Next_Part_0001369404.492
Content-Type: multipart/alternative;
	boundary="----=_Next_Part_0000456468.651"


------=_Next_Part_0000456468.651
Content-Type: text/plain;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

This is a multi-part message in MIME format.

------=_Next_Part_0000456468.651
Content-Type: text/html;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML><html><head>=0D=0A<meta http-equiv=3D"Content-Type=
" content=3D"text/html; charset=3Dgb2312">=0A=0A=0A=0A=0A=0A=0A=0A=
<title>Spark=D1=A7=CF=B0=B1=CA=BC=C7(5)---Spark=D3=A6=D3=C3=B3=CC=
=D0=F2=D6=AE=BC=E4=B5=F7=B6=C8=CB=E3=B7=A8</title>=0A    =0A<styl=
e id=3D"wiz_custom_css">html, .wiz-editor-body {font-size: 12pt;}=
.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB', '=E5=
=BE=AE=E8=BD=AF=E9=9B=85=E9=BB=91', 'Microsoft YaHei UI', SimSun,=
 SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;paddin=
g: 20px 16px;padding: 1.25rem 1rem;}.wiz-editor-body h1,.wiz-edit=
or-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-editor-bo=
dy h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem 0 0.=
625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {font-si=
ze:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18pt;fo=
nt-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-size:1.2=
5rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;}.wiz=
-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-body=20=
h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1rem 0;}=
.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,.wiz-=
editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {margin:8p=
x 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz-edit=
or-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor-body=
 .CodeMirror pre {margin:0;}.wiz-editor-body ul,.wiz-editor-body=20=
ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol.wiz-=
list-level1 > li {list-style-type:decimal;}.wiz-editor-body ol.wi=
z-list-level2 > li {list-style-type:lower-latin;}.wiz-editor-body=
 ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-edito=
r-body blockquote {padding: 0 12px;}.wiz-editor-body blockquote >=
 :first-child {margin-top:0;}.wiz-editor-body blockquote > :last-=
child {margin-bottom:0;}.wiz-editor-body img {border:0;max-width:=
100%;height:auto !important;margin:2px 0;}.wiz-editor-body table=20=
{border-collapse:collapse;border:1px solid #bbbbbb;}.wiz-editor-b=
ody td,.wiz-editor-body th {padding:4px 8px;border-collapse:colla=
pse;border:1px solid #bbbbbb;min-height:28px;word-break:break-wor=
d;box-sizing: border-box;}.wiz-hide {display:none !important;}</s=
tyle></head>=0A=0A<body class=3D"wiz-editor-body"  spellcheck=3D"=
false"><div></div><h1 class=3D"postTitle" style=3D"font-size: 0.9=
75rem;"><a id=3D"cb_post_title_url" class=3D"postTitle2" href=3D"=
https://www.cnblogs.com/yangtong/p/7141337.html" style=3D"color:r=
gb(33, 117, 155);text-decoration:none;">Spark=D1=A7=CF=B0=B1=CA=BC=
=C7(5)---Spark=D3=A6=D3=C3=B3=CC=D0=F2=D6=AE=BC=E4=B5=F7=B6=C8=CB=
=E3=B7=A8</a></h1><div class=3D"clear" style=3D"font-size: 0.833r=
em;"></div><div id=3D"cnblogs_post_body" class=3D"blogpost-body c=
nblogs-markdown" style=3D"font-size:0.875rem"><h1 id=3D"spark=D3=A6=
=D3=C3=B3=CC=D0=F2=D6=AE=BC=E4=B5=F7=B6=C8=CB=E3=B7=A8" style=3D"=
font-size:1.75rem;">Spark=D3=A6=D3=C3=B3=CC=D0=F2=D6=AE=BC=E4=B5=F7=
=B6=C8=CB=E3=B7=A8</h1><p>=D4=DAStandalone=C4=A3=CA=BD=CF=C2=A3=AC=
Master=CC=E1=B9=A9=C0=EF=D7=CA=D4=B4=B9=DC=C0=ED=B5=F7=B6=C8=B9=A6=
=C4=DC=A1=A3=D4=DA=B5=F7=B6=C8=B9=FD=B3=CC=D6=D0=A3=ACMaster=CF=C8=
=C6=F4=B6=AF=B5=C8=B4=FD=C1=D0=B1=ED=D6=D0=D3=A6=D3=C3=B3=CC=D0=F2=
=B5=C4Driver=A3=AC=D5=E2=B8=F6Driver=BE=A1=BF=C9=C4=DC=B7=D6=C9=A2=
=D4=DA=BC=AF=C8=BA=B5=C4Worker=BD=DA=B5=E3=C9=CF=A3=AC=C8=BB=BA=F3=
=B8=F9=BE=DD=BC=AF=C8=BA=B5=C4=C4=DA=B4=E6=BA=CDCPU=CA=B9=D3=C3=C7=
=E9=BF=F6=A3=AC=B6=D4=B5=C8=B4=FD=D4=CB=D0=D0=B5=C4=D3=A6=D3=C3=B3=
=CC=D0=F2=BD=F8=D0=D0=D7=CA=D4=B4=B7=D6=C5=E4=A1=A3=C4=AC=C8=CF=B7=
=D6=C5=E4=B9=E6=D4=F2=CA=C7=D3=D0=CC=F5=BC=FE=B5=C4FIFO=A3=AC=CF=C8=
=B7=D6=C5=E4=B5=C4=D3=A6=D3=C3=B3=CC=D0=F2=BB=E1=BE=A1=BF=C9=C4=DC=
=B6=E0=B5=C4=BB=F1=C8=A1=C2=FA=D7=E3=CC=F5=BC=FE=B5=C4=D7=CA=D4=B4=
=A3=AC=BA=F3=B7=D6=C5=E4=B5=C4=D3=A6=D3=C3=B3=CC=D0=F2=D6=BB=C4=DC=
=D4=DA=CA=A3=D3=E0=D7=CA=D4=B4=D6=D0=D4=D9=B4=CE=C9=B8=D1=A1=A1=A3=
=C8=E7=B9=FB=C3=BB=D3=D0=BA=CF=CA=CA=D7=CA=D4=B4=B5=C4=D3=A6=D3=C3=
=B3=CC=D0=F2=D6=AA=B6=F7=B8=D0=B5=C8=B4=FD=A1=A3Master.scheduler=B7=
=BD=B7=A8=C8=E7=CF=C2=A3=BA</p><pre class=3D"scala"><code class=3D=
"hljs" style=3D"font-size: 0.75rem; background: rgb(255, 255, 255=
);"><span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">=
private</span> <span class=3D"hljs-function"><span class=3D"hljs-=
keyword" style=3D"color:rgb(0, 0, 255);">def</span> <span class=3D=
"hljs-title" style=3D"color:rgb(163, 21, 21);">schedule</span></s=
pan>(): <span class=3D"hljs-type" style=3D"color:rgb(163, 21, 21)=
;">Unit</span> =3D {=0A    <span class=3D"hljs-keyword" style=3D"=
color:rgb(0, 0, 255);">if</span> (state !=3D <span class=3D"hljs-=
type" style=3D"color:rgb(163, 21, 21);">RecoveryState</span>.<spa=
n class=3D"hljs-type" style=3D"color:rgb(163, 21, 21);">ALIVE</sp=
an>) {=0A      <span class=3D"hljs-keyword" style=3D"color:rgb(0,=
 0, 255);">return</span>=0A    }=0A    <span class=3D"hljs-commen=
t" style=3D"color:green;">// =CB=E6=BB=FA=B4=F2=C2=D2Worker=BD=DA=
=B5=E3</span>=0A    <span class=3D"hljs-keyword" style=3D"color:r=
gb(0, 0, 255);">val</span> shuffledAliveWorkers =3D <span class=3D=
"hljs-type" style=3D"color:rgb(163, 21, 21);">Random</span>.shuff=
le(workers.toSeq.filter(_.state =3D=3D <span class=3D"hljs-type"=20=
style=3D"color:rgb(163, 21, 21);">WorkerState</span>.<span class=3D=
"hljs-type" style=3D"color:rgb(163, 21, 21);">ALIVE</span>))=0A =20=
  <span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">va=
l</span> numWorkersAlive =3D shuffledAliveWorkers.size=0A    <spa=
n class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">var</spa=
n> curPos =3D <span class=3D"hljs-number">0</span>=0A    <span cl=
ass=3D"hljs-comment" style=3D"color:green;">// =D5=E2=CA=C7=D6=BB=
=B6=D4Standalone=CF=C2=B5=C4Cluster=C4=A3=CA=BD=B2=C5=C9=FA=D0=A7=
=A3=ACclient=C4=A3=CA=BDDriver=CA=C7=D4=DA=BF=CD=BB=A7=B6=CB</spa=
n>=0A    <span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 25=
5);">for</span> (driver &lt;- waitingDrivers.toList) { =0A      <=
span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">var</=
span> launched =3D <span class=3D"hljs-literal" style=3D"color:rg=
b(163, 21, 21);">false</span>=0A      <span class=3D"hljs-keyword=
" style=3D"color:rgb(0, 0, 255);">var</span> numWorkersVisited =3D=
 <span class=3D"hljs-number">0</span>=0A      <span class=3D"hljs=
-keyword" style=3D"color:rgb(0, 0, 255);">while</span> (numWorker=
sVisited &lt; numWorkersAlive &amp;&amp; !launched) {=0A        <=
span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">val</=
span> worker =3D shuffledAliveWorkers(curPos)=0A        numWorker=
sVisited +=3D <span class=3D"hljs-number">1</span>=0A        <spa=
n class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">if</span=
> (worker.memoryFree &gt;=3D driver.desc.mem &amp;&amp; worker.co=
resFree &gt;=3D driver.desc.cores) {=0A          launchDriver(wor=
ker, driver)=0A          waitingDrivers -=3D driver=0A          l=
aunched =3D <span class=3D"hljs-literal" style=3D"color:rgb(163,=20=
21, 21);">true</span>=0A        }=0A        curPos =3D (curPos +=20=
<span class=3D"hljs-number">1</span>) % numWorkersAlive=0A      }=
=0A    }=0A    <span class=3D"hljs-comment" style=3D"color:green;=
">// =B6=D4=B5=C8=B4=FD=D3=A6=D3=C3=B3=CC=D0=F2=B0=B4=D5=D5=CB=B3=
=D0=F2=B7=D6=C5=E4=D4=CB=D0=D0=D7=CA=D4=B4</span>=0A    startExec=
utorsOnWorkers()=0A  }</code></pre><p>=C4=AC=C8=CF=C7=E9=BF=F6=CF=
=C2=A3=AC=D4=DAStandalone=C4=A3=CA=BD=CF=C2=A3=AC=C3=BF=B8=F6=D3=A6=
=D3=C3=B3=CC=D0=F2=BF=C9=D2=D4=B7=D6=C5=E4=B5=BD=B5=C4CPU=BA=CB=CA=
=FD=BF=C9=D2=D4=D3=C9spark.deploy.defaultCores=BD=F8=D0=D0=C9=E8=D6=
=C3=A3=AC=B5=AB=CA=C7=B8=C3=C5=E4=D6=C3=C4=AC=C8=CF=CE=AAInt.max=A3=
=AC=D2=B2=BE=CD=CA=C7=B2=BB=CF=DE=D6=C6=A3=AC=B4=D3=B6=F8=D3=A6=D3=
=C3=B3=CC=D0=F2=BB=E1=BE=A1=BF=C9=C4=DC=BB=F1=C8=A1CPU=D7=CA=D4=B4=
=A1=A3=CE=AA=C1=CB=CF=DE=D6=C6=C3=BF=B8=F6=D3=A6=D3=C3=B3=CC=D0=F2=
=CA=B9=D3=C3CPU=D7=CA=D4=B4=A3=AC=D3=C3=BB=A7=D2=BB=B7=BD=C3=E6=BF=
=C9=D2=D4=C9=E8=D6=C3spark.core.max=C5=E4=D6=C3=CF=EE=A3=AC=D4=BC=
=CA=F8=C3=BF=B8=F6=D3=A6=D3=C3=B3=CC=D0=F2=CB=F9=C4=DC=C9=EA=C7=EB=
=B5=C4=D7=EE=B4=F3CPU=BA=CB=CA=FD=A3=BB=C1=ED=D2=BB=B7=BD=C3=E6=BF=
=C9=D2=D4=C9=E8=D6=C3spark.executor.cores=C5=E4=D6=C3=CF=EE=A3=AC=
=D3=C3=D3=DA=C9=E8=D6=C3=D4=DA=C3=BF=B8=F6Executor=C9=CF=C6=F4=B6=
=AF=B5=C4CPU=BA=CB=CA=FD=A1=A3</p><p>=B6=D4=D3=DAWorker=B5=C4=B7=D6=
=C5=E4=B2=DF=C2=D4=D3=D0=C1=BD=D6=D6:=D2=BB=D6=D6=CA=C7=BE=A1=C1=BF=
=B0=D1=D3=A6=D3=C3=B3=CC=D0=F2=D4=CB=D0=D0=BF=C9=C4=DC=B6=E0=B5=C4=
Worker=C9=CF=A3=AC=D5=E2=D6=D6=B7=D6=C5=E4=CB=E3=B7=A8=B2=BB=BD=F6=
=C4=DC=B3=E4=B7=D6=C0=FB=D3=C3=BC=AF=C8=BA=D7=CA=D4=B4=A3=AC=BB=B9=
=D3=D0=C0=FB=D3=DA=CA=FD=BE=DD=B1=BE=B5=D8=D0=D4=A3=BB=C1=ED=D2=BB=
=D6=D6=BE=CD=CA=C7=D3=A6=D3=C3=B3=CC=D0=F2=D4=CB=D0=D0=D4=DA=BE=A1=
=C1=BF=C9=D9=B5=C4Worker=C9=CF=A3=AC=D5=E2=D6=D6=CA=CA=D3=C3=D3=DA=
CPU=C3=DC=BC=AF=D0=CD=B6=F8=C4=DA=B4=E6=CA=B9=D3=C3=BD=CF=C9=D9=B5=
=C4=B3=A1=BE=B0=A1=A3=C5=E4=D6=C3=CF=EE=CE=AAspark.deploy.spreadO=
ut=A1=A3=D6=F7=D2=AA=B4=FA=C2=EB=CE=AA=A3=BAMaster.scheduleExecut=
orsOnWorkers=B7=BD=B7=A8=CA=B5=CF=D6=A1=A3</p><pre class=3D"scala=
"><code class=3D"hljs" style=3D"font-size: 0.75rem; background: r=
gb(255, 255, 255);"><span class=3D"hljs-keyword" style=3D"color:r=
gb(0, 0, 255);">private</span> <span class=3D"hljs-function"><spa=
n class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">def</spa=
n> <span class=3D"hljs-title" style=3D"color:rgb(163, 21, 21);">s=
cheduleExecutorsOnWorkers</span></span>(app: <span class=3D"hljs-=
type" style=3D"color:rgb(163, 21, 21);">ApplicationInfo</span>,us=
ableWorkers: <span class=3D"hljs-type" style=3D"color:rgb(163, 21=
, 21);">Array</span>[<span class=3D"hljs-type" style=3D"color:rgb=
(163, 21, 21);">WorkerInfo</span>],spreadOutApps: <span class=3D"=
hljs-type" style=3D"color:rgb(163, 21, 21);">Boolean</span>): <sp=
an class=3D"hljs-type" style=3D"color:rgb(163, 21, 21);">Array</s=
pan>[<span class=3D"hljs-type" style=3D"color:rgb(163, 21, 21);">=
Int</span>] =3D {=0A<span class=3D"hljs-comment" style=3D"color:g=
reen;">// =D3=A6=D3=C3=B3=CC=D0=F2=D6=D0=C3=BF=B8=F6Executor=CB=F9=
=D0=E8=D2=AA=B5=C4CPU=BA=CB=CA=FD</span>=0A<span class=3D"hljs-ke=
yword" style=3D"color:rgb(0, 0, 255);">val</span> coresPerExecuto=
r =3D app.desc.coresPerExecutor=0A<span class=3D"hljs-comment" st=
yle=3D"color:green;">// =C3=BF=B8=F6Executor=CB=F9=D0=E8=B5=C4=D7=
=EE=C9=D9=BA=CB=CA=FD=A3=AC=C8=E7=B9=FB=C9=E8=D6=C3=C1=CBcoresPer=
Executor=D4=F2=CE=AA=B8=C3=D6=B5=A3=AC=B7=F1=D4=F2=CE=AA1</span>=0A=
<span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">val<=
/span> minCoresPerExecutor =3D coresPerExecutor.getOrElse(<span c=
lass=3D"hljs-number">1</span>)=0A<span class=3D"hljs-comment" sty=
le=3D"color:green;">// =C8=E7=B9=FB=C3=BB=D3=D0=C9=E8=D6=C3coresP=
erExecutor=A3=AC=C4=C7=C3=B4=C3=BF=B8=F6Worker=C9=CF=D6=BB=D3=D0=D2=
=BB=B8=F6Executor</span>=0A<span class=3D"hljs-keyword" style=3D"=
color:rgb(0, 0, 255);">val</span> oneExecutorPerWorker =3D coresP=
erExecutor.isEmpty=0A<span class=3D"hljs-comment" style=3D"color:=
green;">// =C3=BF=B8=F6Executor=D0=E8=D2=AA=B7=D6=C5=E4=B6=E0=C9=D9=
=C4=DA=B4=E6</span>=0A<span class=3D"hljs-keyword" style=3D"color=
:rgb(0, 0, 255);">val</span> memoryPerExecutor =3D app.desc.memor=
yPerExecutorMB=0A<span class=3D"hljs-comment" style=3D"color:gree=
n;">// =BF=C9=D3=C3Worker=CA=FD=C1=BF</span>=0A<span class=3D"hlj=
s-keyword" style=3D"color:rgb(0, 0, 255);">val</span> numUsable =3D=
 usableWorkers.length=0A<span class=3D"hljs-comment" style=3D"col=
or:green;">// Worker=BD=DA=B5=E3=CB=F9=C4=DC=CC=E1=B9=A9=B5=C4CPU=
=BA=CB=CA=FD=CA=FD=D7=E9</span>=0A<span class=3D"hljs-keyword" st=
yle=3D"color:rgb(0, 0, 255);">val</span> assignedCores =3D <span=20=
class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">new</span>=
 <span class=3D"hljs-type" style=3D"color:rgb(163, 21, 21);">Arra=
y</span>[<span class=3D"hljs-type" style=3D"color:rgb(163, 21, 21=
);">Int</span>](numUsable) <span class=3D"hljs-comment" style=3D"=
color:green;">// Number of cores to give to each worker</span>=0A=
<span class=3D"hljs-comment" style=3D"color:green;">// Worker=C9=CF=
Executor=B8=F6=CA=FD=CA=FD=D7=E9</span>=0A<span class=3D"hljs-key=
word" style=3D"color:rgb(0, 0, 255);">val</span> assignedExecutor=
s =3D <span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);=
">new</span> <span class=3D"hljs-type" style=3D"color:rgb(163, 21=
, 21);">Array</span>[<span class=3D"hljs-type" style=3D"color:rgb=
(163, 21, 21);">Int</span>](numUsable) <span class=3D"hljs-commen=
t" style=3D"color:green;">// Number of new executors on each work=
er</span>=0A<span class=3D"hljs-comment" style=3D"color:green;">/=
/ =D0=E8=D2=AA=B7=D6=C5=E4=B5=C4CPU=BA=CB=CA=FD=A3=AC=CE=AA=D3=A6=
=D3=C3=B3=CC=D0=F2=CB=F9=D0=E8CPU=BA=CB=CA=FD=BA=CD=BF=C9=D3=C3CP=
U=BA=CB=CA=FD=D7=EE=D0=A1=D6=B5</span>=0A<span class=3D"hljs-keyw=
ord" style=3D"color:rgb(0, 0, 255);">var</span> coresToAssign =3D=
 math.min(app.coresLeft, usableWorkers.map(_.coresFree).sum)=0A=0A=
<span class=3D"hljs-comment" style=3D"color:green;">/**=0A * =B7=B5=
=BB=D8=D6=B8=B6=A8=B5=C4Worker=BD=DA=B5=E3=CA=C7=B7=F1=C4=DC=B9=BB=
=C6=F4=B6=AFExecutor=A3=AC=C2=FA=D7=E3=CC=F5=BC=FE=A3=BA=0A *   1=
. =D3=A6=D3=C3=B3=CC=D0=F2=D0=E8=D2=AA=B7=D6=C5=E4CPU=BA=CB=CA=FD=
&gt;=3D=C3=BF=B8=F6Executor=CB=F9=D0=E8=B5=C4=D7=EE=C9=D9CPU=BA=CB=
=CA=FD=0A *   2. =CA=C7=B7=F1=D3=D0=D7=E3=B9=BB=B5=C4CPU=BA=CB=CA=
=FD=A3=AC=C5=D0=B6=CF=CC=F5=BC=FE=CE=AA=B8=C3Worker=BD=DA=B5=E3=BF=
=C9=D3=C3CPU=BA=CB=CA=FD-=B8=C3Worker=BD=DA=B5=E3=D2=D1=B7=D6=C5=E4=
=B5=C4CPU=BA=CB=CA=FD&gt;=3D=C3=BF=B8=F6Executor=CB=F9=D0=E8=D7=EE=
=C9=D9CPU=BA=CB=CA=FD=0A * =C8=E7=B9=FB=D4=DA=B8=C3Worker=BD=DA=B5=
=E3=C9=CF=D4=CA=D0=ED=C6=F4=B6=AF=D0=C2=B5=C4Executor=A3=AC=D0=E8=
=D2=AA=D7=B7=BC=D3=D2=D4=CF=C2=C1=BD=B8=F6=CC=F5=BC=FE=A3=BA=0A *=
   1. =C5=D0=B6=CF=C4=DA=B4=E6=CA=C7=B7=F1=D7=E3=B9=BB=C6=F4=B6=AF=
Executor=A3=AC=C6=E4=B7=BD=B7=A8=CA=C7=A3=BA=B5=B1=C7=B0Worker=BD=
=DA=B5=E3=BF=C9=D3=C3=C4=DA=B4=E6-=B8=C3Worker=D2=D1=B7=D6=C5=E4=B5=
=C4=C4=DA=B4=E6&gt;=3D=C3=BF=B8=F6Executor=B7=D6=C5=E4=B5=C4=C4=DA=
=B4=E6=B4=F3=D0=A1=0A *   2. =D2=D1=BE=AD=B7=D6=C5=E4=B8=F8=B8=C3=
=D3=A6=D3=C3=B3=CC=D0=F2=B5=C4Executor=CA=FD=C1=BF+=D2=D1=BE=AD=D4=
=CB=D0=D0=B8=C3=D3=A6=D3=C3=B3=CC=D0=F2=B5=C4Executor=CA=FD=C1=BF=
&lt;=B8=C3=D3=A6=D3=C3=B3=CC=D0=F2Executor=C9=E8=D6=C3=B5=C4=D7=EE=
=B4=F3=D6=B5=0A */</span>=0A<span class=3D"hljs-function"><span c=
lass=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">def</span>=20=
<span class=3D"hljs-title" style=3D"color:rgb(163, 21, 21);">canL=
aunchExecutor</span></span>(pos: <span class=3D"hljs-type" style=3D=
"color:rgb(163, 21, 21);">Int</span>): <span class=3D"hljs-type"=20=
style=3D"color:rgb(163, 21, 21);">Boolean</span> =3D {=0A  <span=20=
class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">val</span>=
 keepScheduling =3D coresToAssign &gt;=3D minCoresPerExecutor=0A=20=
 <span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">val=
</span> enoughCores =3D usableWorkers(pos).coresFree - assignedCo=
res(pos) &gt;=3D minCoresPerExecutor=0A=0A  <span class=3D"hljs-c=
omment" style=3D"color:green;">// =C6=F4=B6=AF=D0=C2Executor=CC=F5=
=BC=FE=CA=C7=A3=BA=B8=C3Worker=BD=DA=B5=E3=D4=CA=D0=ED=C6=F4=B6=AF=
=B6=E0=B8=F6Executor=BB=F2=D5=DF=D4=DA=B8=C3Worker=BD=DA=B5=E3=C9=
=CF=C3=BB=D3=D0=CE=AA=B8=C3=D3=A6=D3=C3=B3=CC=D0=F2=B7=D6=C5=E4Ex=
ecutor</span>=0A  <span class=3D"hljs-keyword" style=3D"color:rgb=
(0, 0, 255);">val</span> launchingNewExecutor =3D !oneExecutorPer=
Worker || assignedExecutors(pos) =3D=3D <span class=3D"hljs-numbe=
r">0</span>=0A  <span class=3D"hljs-comment" style=3D"color:green=
;">// =C8=E7=B9=FB=D4=DA=B8=C3Worker=BD=DA=B5=E3=C9=CF=D4=CA=D0=ED=
=C6=F4=B6=AF=B6=E0=B8=F6Executor=A3=AC=C4=C7=C3=B4=B8=C3Executor=BD=
=DA=B5=E3=C2=FA=D7=E3=C6=F4=B6=AF=CC=F5=BC=FE=BE=CD=BF=C9=D2=D4=C6=
=F4=B6=AF=D0=C2Executor=A3=AC</span>=0A  <span class=3D"hljs-comm=
ent" style=3D"color:green;">// =B7=F1=D4=F2=D6=BB=C4=DC=C6=F4=B6=AF=
=D2=BB=B8=F6Executor=B2=A2=BE=A1=BF=C9=C4=DC=B5=C4=B6=E0=B7=D6=C5=
=E4CPU=BA=CB=CA=FD</span>=0A  <span class=3D"hljs-keyword" style=3D=
"color:rgb(0, 0, 255);">if</span> (launchingNewExecutor) {=0A   =20=
<span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">val<=
/span> assignedMemory =3D assignedExecutors(pos) * memoryPerExecu=
tor=0A    <span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 2=
55);">val</span> enoughMemory =3D usableWorkers(pos).memoryFree -=
 assignedMemory &gt;=3D memoryPerExecutor=0A    <span class=3D"hl=
js-keyword" style=3D"color:rgb(0, 0, 255);">val</span> underLimit=
 =3D assignedExecutors.sum + app.executors.size &lt; app.executor=
Limit=0A    keepScheduling &amp;&amp; enoughCores &amp;&amp; enou=
ghMemory &amp;&amp; underLimit=0A  } <span class=3D"hljs-keyword"=
 style=3D"color:rgb(0, 0, 255);">else</span> {=0A    <span class=3D=
"hljs-comment" style=3D"color:green;">// We're adding cores to an=
 existing executor, so no need</span>=0A    <span class=3D"hljs-c=
omment" style=3D"color:green;">// to check memory and executor li=
mits</span>=0A    keepScheduling &amp;&amp; enoughCores=0A  }=0A}=
=0A=0A<span class=3D"hljs-comment" style=3D"color:green;">// =D4=DA=
=BF=C9=D3=C3=B5=C4Worker=BD=DA=B5=E3=D6=D0=C6=F4=B6=AFExecutor=A3=
=AC=D4=DAWorker=BD=DA=B5=E3=C3=BF=B4=CE=B7=D6=C5=E4=D7=CA=D4=B4=CA=
=B1=A3=AC=B7=D6=C5=E4=B8=F8Executor=CB=F9=D0=E8=B5=C4=D7=EE=C9=D9=
CPU=BA=CB=CA=FD=A3=AC=B8=C3=B9=FD=B3=CC=CA=C7=CD=A8=B9=FD=B6=E0=B4=
=CE=C2=D6=D1=AF=BD=F8=D0=D0=A3=AC</span>=0A<span class=3D"hljs-co=
mment" style=3D"color:green;">// =D6=B1=B5=BD=C3=BB=D3=D0Worker=BD=
=DA=B5=E3=C2=FA=D7=E3=C6=F4=B6=AFExecutor=CC=F5=BC=FE=BB=EE=D7=C5=
=D2=D1=BE=AD=B4=EF=B5=BD=D3=A6=D3=C3=B3=CC=D0=F2=CF=DE=D6=C6=A1=A3=
=D4=DA=B7=D6=C5=E4=B9=FD=B3=CC=D6=D0Worker=BD=DA=B5=E3=BF=C9=C4=DC=
=B6=E0=B4=CE=B7=D6=C5=E4=A3=AC</span>=0A<span class=3D"hljs-comme=
nt" style=3D"color:green;">// =C8=E7=B9=FB=B8=C3Worker=BD=DA=B5=E3=
=BF=C9=D2=D4=C6=F4=B6=AF=B6=E0=B8=F6Executor=A3=AC=D4=F2=C3=BF=B4=
=CE=B7=D6=C5=E4=B5=C4=CA=B1=BA=F2=C6=F4=B6=AF=D0=C2=B5=C4Executor=
=B2=A2=B8=B3=D3=E8=D7=CA=D4=B4=A3=BB</span>=0A<span class=3D"hljs=
-comment" style=3D"color:green;">// =C8=E7=B9=FB=B8=C3Worker=BD=DA=
=B5=E3=D6=BB=C4=DC=C6=F4=B6=AF=D2=BB=B8=F6Executor=A3=AC=D4=F2=C3=
=BF=B4=CE=B7=D6=C5=E4=B5=C4=CA=B1=BA=F2=B0=D1=D7=CA=D4=B4=D7=B7=BC=
=D3=B5=BD=B8=C3Executor</span>=0A<span class=3D"hljs-keyword" sty=
le=3D"color:rgb(0, 0, 255);">var</span> freeWorkers =3D (<span cl=
ass=3D"hljs-number">0</span> until numUsable).filter(canLaunchExe=
cutor)=0A<span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 25=
5);">while</span> (freeWorkers.nonEmpty) {=0A  freeWorkers.foreac=
h { pos =3D&gt;=0A    <span class=3D"hljs-keyword" style=3D"color=
:rgb(0, 0, 255);">var</span> keepScheduling =3D <span class=3D"hl=
js-literal" style=3D"color:rgb(163, 21, 21);">true</span>=0A    <=
span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">while=
</span> (keepScheduling &amp;&amp; canLaunchExecutor(pos)) {=0A =20=
    <span class=3D"hljs-comment" style=3D"color:green;">// =C3=BF=
=B4=CE=B7=D6=C5=E4=D7=EE=C9=D9Executor=CB=F9=D0=E8CPU=BA=CB=CA=FD=
</span>=0A      coresToAssign -=3D minCoresPerExecutor=0A      as=
signedCores(pos) +=3D minCoresPerExecutor=0A=0A      <span class=3D=
"hljs-comment" style=3D"color:green;">// =C8=E7=B9=FB=C9=E8=D6=C3=
=C3=BF=B8=F6Executor=C6=F4=B6=AFCPU=BA=CB=CA=FD=A3=AC=D4=F2=B8=C3=
Worker=D6=BB=C4=DC=CE=AA=B8=C3=D3=A6=D3=C3=B3=CC=D0=F2=C6=F4=B6=AF=
1=B8=F6Executor=A3=AC</span>=0A      <span class=3D"hljs-comment"=
 style=3D"color:green;">// =B7=F1=D4=F2=D4=DA=C3=BF=B4=CE=B7=D6=C5=
=E4=D6=D0=C6=F4=B6=AF1=B8=F6=D0=C2=B5=C4Executor</span>=0A      <=
span class=3D"hljs-keyword" style=3D"color:rgb(0, 0, 255);">if</s=
pan> (oneExecutorPerWorker) {=0A        assignedExecutors(pos) =3D=
 <span class=3D"hljs-number">1</span>=0A      } <span class=3D"hl=
js-keyword" style=3D"color:rgb(0, 0, 255);">else</span> {=0A    =20=
   assignedExecutors(pos) +=3D <span class=3D"hljs-number">1</spa=
n>=0A      }=0A=0A      <span class=3D"hljs-comment" style=3D"col=
or:green;">// =C8=E7=B9=FB=CA=C7=B7=D6=C9=A2=D4=CB=D0=D0=A3=AC=D4=
=F2=D4=DA=C4=B3=D2=BBWorker=BD=DA=B5=E3=C9=CF=D7=F6=CD=EA=D7=CA=D4=
=B4=B7=D6=C5=E4=C1=A2=BC=B4=D2=C6=B5=BD=CF=C2=D2=BB=B8=F6Worker=BD=
=DA=B5=E3=A3=AC</span>=0A      <span class=3D"hljs-comment" style=
=3D"color:green;">// =C8=E7=B9=FB=CA=C7=BC=AF=D6=D0=D4=CB=D0=D0=A3=
=AC=D4=F2=B3=D6=D0=F8=D4=DA=C4=B3=D2=BBWorker=BD=DA=B5=E3=C9=CF=D7=
=F6=D7=CA=D4=B4=B7=D6=C5=E4=A3=AC=D6=AA=B5=C0=CA=B9=D3=C3=CD=EA=B8=
=C3Worker=BD=DA=B5=E3=CB=F9=D3=D0=D7=CA=D4=B4=A1=A3</span>=0A   =20=
  <span class=3D"hljs-comment" style=3D"color:green;">// =B4=AB=C8=
=EB=B5=C4Worker=BD=DA=B5=E3=C1=D0=B1=ED=CA=C7=B0=B4=D5=D5CPU=BA=CB=
=CA=FD=B5=B9=D0=F2=C5=C5=C1=D0=A3=AC=D4=DA=BC=AF=D6=D0=D4=CB=D0=D0=
=CA=B1=A3=AC=BB=E1=BE=A1=BF=C9=C4=DC=C9=D9=B5=C4=CA=B9=D3=C3Worke=
r=BD=DA=B5=E3</span>=0A      <span class=3D"hljs-keyword" style=3D=
"color:rgb(0, 0, 255);">if</span> (spreadOutApps) {=0A        kee=
pScheduling =3D <span class=3D"hljs-literal" style=3D"color:rgb(1=
63, 21, 21);">false</span>=0A      }=0A    }=0A  }=0A  <span clas=
s=3D"hljs-comment" style=3D"color:green;">// =BC=CC=D0=F8=B4=D3=C9=
=CF=D2=BB=B4=CE=B7=D6=C5=E4=CD=EA=B5=C4=BF=C9=D3=C3Worker=BD=DA=B5=
=E3=C1=D0=B1=ED=BB=F1=C8=A1=C2=FA=D7=E3=C6=F4=B6=AFExecutor=B5=C4=
Worker=BD=DA=B5=E3=C1=D0=B1=ED</span>=0A  freeWorkers =3D freeWor=
kers.filter(canLaunchExecutor)=0A}=0A<span class=3D"hljs-comment"=
 style=3D"color:green;">// =B7=B5=BB=D8=C3=BF=B8=F6Worker=BD=DA=B5=
=E3=B7=D6=C5=E4=B5=C4CPU=BA=CB=CA=FD</span>=0AassignedCores=0A}</=
code></pre><blockquote style=3D"color:rgb(51, 51, 51);background:=
none;"><p>tips:<br>=B9=D8=D3=DA<a href=3D"https://github.com/apac=
he/spark/pull/7274" style=3D"color:black;text-decoration:underlin=
e;">Spark-8881</a>=A3=AC=D5=E2=B8=F6=CB=E3=B7=A8=CA=C7=D4=DASpark=
 1.4.2=B5=C4=B0=E6=B1=BE=D6=D0=D3=C5=BB=AF=B5=C4=A1=A3=D4=DA=D2=D4=
=C7=B0=A3=ACWorker=BD=DA=B5=E3=D6=D0=A3=AC=D6=BB=C4=DC=CE=AA=C4=B3=
=D3=A6=D3=C3=B3=CC=D0=F2=C6=F4=B6=AF=D2=BB=B8=F6Executor=A1=A3=C2=
=D6=D1=AF=B7=D6=C5=E4=D7=CA=D4=B4=CA=B1=A3=ACWorker=BD=DA=B5=E3=C3=
=BF=B4=CE=B7=D6=C5=E41=B8=F6CPU=BA=CB=CA=FD=A3=AC=D5=E2=D1=F9=D3=D0=
=BF=C9=C4=DC=BB=E1=D4=EC=B3=C9=C4=B3=B8=F6Worker=BD=DA=B5=E3=D7=EE=
=D6=D5=B7=D6=C5=E4CPU=BA=CB=CA=FD=D0=A1=D3=DA=C3=BF=B8=F6Executor=
=CB=F9=D0=E8CPU=BA=CB=CA=FD=A3=AC=C4=C7=C3=B4=B8=C3=BD=DA=B5=E3=BD=
=AB=B2=BB=C6=F4=B6=AF=B8=C3Executor=A1=A3=C0=FD=C8=E7=A3=BA<br>=D4=
=DA=BC=AF=C8=BA=D6=D0=D3=D04=B8=F6Worker=BD=DA=B5=E3=A3=AC=C3=BF=B8=
=F6=BD=DA=B5=E3=D3=B5=D3=D016=B8=F6CPU=BA=CB=CA=FD=A3=AC=C6=E4=D6=
=D0=C9=E8=D6=C3=C1=CBspark.cores.max=3D48=BA=CDspark.executor.cor=
es=3D16=A3=AC=D3=C9=D3=DA=C3=BF=B8=F6Worker=D6=BB=C6=F4=B6=AF=D2=BB=
=B8=F6Executor=A3=AC=B0=B4=D5=D5=C3=BF=B4=CE=B7=D6=C5=E4=D2=BB=B8=
=F6CPU=BA=CB=CA=FD=A3=AC=D4=F2=C3=BF=B8=F6Worker=BD=DA=B5=E3=B5=C4=
Executor=BD=AB=B7=D6=C5=E4=B5=BD12=B8=F6CPU=BA=CB=CA=FD=A3=AC=C3=BF=
=B8=F6=D3=C9=D3=DA12&lt;16, =CB=F9=D2=D4=C3=BB=D3=D0Executor=C4=DC=
=C6=F4=B6=AF=A1=A3=CF=D6=D4=DA=B8=C4=BD=F8=B5=C4=CB=E3=B7=A8=CA=C7=
=A3=AC=C8=E7=B9=FB=C9=E8=D6=C3=C1=CBspark.executor.cores=A3=AC=C4=
=C7=C3=B4=C3=BF=B4=CE=B7=D6=C5=E4=B5=C4=CA=B1=BA=F2=BE=CD=B7=D6=C5=
=E4=D5=E2=B8=F6=D6=B8=B6=A8=B5=C4CPU=BA=CB=CA=FD=A3=AC=B7=F1=D4=F2=
=BB=B9=CA=C7=B7=D6=C5=E41=B8=F6=A1=A3</p></blockquote><h1 id=3D"=B2=
=CE=BF=BC=D7=CA=C1=CF" style=3D"font-size:1.75rem;">=B2=CE=BF=BC=D7=
=CA=C1=CF</h1></div><p style=3D"font-size:0.875rem"><a href=3D"ht=
tp://www.cnblogs.com/shishanyuan/" style=3D"text-decoration: unde=
rline;">=CD=BC=BD=E2Spark: =BA=CB=D0=C4=BC=BC=CA=F5=D3=EB=B0=B8=C0=
=FD=CA=B5=D5=BD</a></p><div class=3D"postBody" style=3D"font-size=
: 0.875rem;"><br></div><div style=3D"font-size:0.875rem;color:gra=
y"><small>=C0=B4=D4=B4=A3=BA&nbsp;<a href=3D"https://www.cnblogs.=
com/yangtong/p/7141337.html">https://www.cnblogs.com/yangtong/p/7=
141337.html</a></small></div></body></html>=0A=0A=0A=0A=0A=0A=0A=0A=
=0A=0A=0A=0A

------=_Next_Part_0000456468.651--

------=_Next_Part_0001369404.492--

