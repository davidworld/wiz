From: WizMime<support@wiz.cn>
Subject: =?gb2312?B?U2NhbGHW0NfUtqjS5cDbvNPG97XEyrnTww==?=
Date: Date: Fri, 23 Jul 2021 05:54:40 +0800
MIME-Version: 1.0
Content-Type: multipart/related;
	type="multipart/alternative";
	boundary="----=_Next_Part_0001282404.226"

This is a multi-part message in MIME format.

------=_Next_Part_0001282404.226
Content-Type: multipart/alternative;
	boundary="----=_Next_Part_0000427468.203"


------=_Next_Part_0000427468.203
Content-Type: text/plain;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

This is a multi-part message in MIME format.

------=_Next_Part_0000427468.203
Content-Type: text/html;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML><html><head>=0D=0A<meta http-equiv=3D"Content-Type=
" content=3D"text/html; charset=3Dgb2312">=0A=0A=0A=0A=0A=0A=0A=0A=
=0A<title>Scala=D6=D0=D7=D4=B6=A8=D2=E5=C0=DB=BC=D3=C6=F7=B5=C4=CA=
=B9=D3=C3</title>=0A    =0A<style id=3D"wiz_custom_css">html, .wi=
z-editor-body {font-size: 12pt;}.wiz-editor-body {font-family: He=
lvetica, 'Hiragino Sans GB', '=E5=BE=AE=E8=BD=AF=E9=9B=85=E9=BB=91=
', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-h=
eight: 1.7;margin: 0 auto;padding: 20px 16px;padding: 1.25rem 1re=
m;}.wiz-editor-body h1,.wiz-editor-body h2,.wiz-editor-body h3,.w=
iz-editor-body h4,.wiz-editor-body h5,.wiz-editor-body h6 {margin=
:20px 0 10px;margin:1.25rem 0 0.625rem;padding: 0;font-weight: bo=
ld;}.wiz-editor-body h1 {font-size:20pt;font-size:1.67rem;}.wiz-e=
ditor-body h2 {font-size:18pt;font-size:1.5rem;}.wiz-editor-body=20=
h3 {font-size:15pt;font-size:1.25rem;}.wiz-editor-body h4 {font-s=
ize:14pt;font-size:1.17rem;}.wiz-editor-body h5 {font-size:12pt;f=
ont-size:1rem;}.wiz-editor-body h6 {font-size:12pt;font-size:1rem=
;color: #777777;margin: 1rem 0;}.wiz-editor-body div,.wiz-editor-=
body p,.wiz-editor-body ul,.wiz-editor-body ol,.wiz-editor-body d=
l,.wiz-editor-body li {margin:8px 0;}.wiz-editor-body blockquote,=
.wiz-editor-body table,.wiz-editor-body pre,.wiz-editor-body code=
 {margin:8px 0;}.wiz-editor-body .CodeMirror pre {margin:0;}.wiz-=
editor-body ul,.wiz-editor-body ol {padding-left:32px;padding-lef=
t:2rem;}.wiz-editor-body ol.wiz-list-level1 > li {list-style-type=
:decimal;}.wiz-editor-body ol.wiz-list-level2 > li {list-style-ty=
pe:lower-latin;}.wiz-editor-body ol.wiz-list-level3 > li {list-st=
yle-type:lower-roman;}.wiz-editor-body blockquote {padding: 0 12p=
x;}.wiz-editor-body blockquote > :first-child {margin-top:0;}.wiz=
-editor-body blockquote > :last-child {margin-bottom:0;}.wiz-edit=
or-body img {border:0;max-width:100%;height:auto !important;margi=
n:2px 0;}.wiz-editor-body table {border-collapse:collapse;border:=
1px solid #bbbbbb;}.wiz-editor-body td,.wiz-editor-body th {paddi=
ng:4px 8px;border-collapse:collapse;border:1px solid #bbbbbb;min-=
height:28px;word-break:break-word;box-sizing: border-box;}.wiz-hi=
de {display:none !important;}</style></head>=0A=0A<body class=3D"=
wiz-editor-body"  spellcheck=3D"false" style=3D"opacity: 1;"><div=
><h1>Scala=D6=D0=D7=D4=B6=A8=D2=E5=C0=DB=BC=D3=C6=F7=B5=C4=CA=B9=D3=
=C3</h1></div><div><span>2018=C4=EA08=D4=C201=C8=D5 20:05:26</spa=
n><span>&nbsp;</span><a href=3D"https://me.csdn.net/u011115903" t=
arget=3D"_blank">=CC=CD=B7=E0=B9=A4</a><span>&nbsp;</span><span>=D4=
=C4=B6=C1=CA=FD=A3=BA691</span></div><div><br><p>&nbsp;=CA=B9=D3=C3=
=D7=D4=B6=A8=D2=E5=C0=DB=BC=D3=C6=F7=B5=C4=C4=BF=B5=C4=A3=BA</p><=
p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =C8=E7=B9=
=FB=D2=AA=CA=B9=D3=C3=B6=E0=B8=F6=C0=DB=BC=D3=C6=F7=B5=C4=BB=B0=A3=
=AC=BB=E1=CA=B9=B3=CC=D0=F2=B1=E4=B5=C4=B8=B4=D4=D3=A3=AC=B2=BB=B1=
=E3=D3=DA=C0=A9=D5=B9=CE=AC=BB=A4</p><p>&nbsp;=B4=FA=C2=EB=CA=B5=CF=
=D6</p><div id=3D"content_views"><pre name=3D"code"><ol class=3D"=
hljs-ln wiz-list-level1" style=3D"background-image: initial; back=
ground-attachment: initial; background-size: initial; background-=
origin: initial; background-clip: initial; background-position: i=
nitial; background-repeat: initial;"><li><div data-line-number=3D=
"1"></div><div><span>import</span> org.apache.spark.{AccumulatorP=
aram, SparkConf, SparkContext}</div></li><li><div data-line-numbe=
r=3D"2"></div><div> </div></li><li><div data-line-number=3D"3"></=
div><div>object CustomAccumulator extends AccumulatorParam[String=
] {</div></li><li><div data-line-number=3D"4"></div><div>  <span>=
override def </span><span><span>zero</span></span><span><span>(in=
itialValue: String)</span></span><span>: String </span>=3D <span>=
"SESSION_COUNT=3D0|TIME_PERIOD_1s_3s=3D0|TIME_PERIOD_4s_6s=3D0|ST=
EP_PERIOD_1_3=3D0|STEP_PERIOD_4_6=3D0"</span></div></li><li><div=20=
data-line-number=3D"5"></div><div> </div></li><li><div data-line-=
number=3D"6"></div><div>  <span>override def </span><span><span>a=
ddInPlace</span></span><span><span>(v1: String, v2: String)</span=
></span><span>: String </span>=3D add(v1, v2)</div></li><li><div=20=
data-line-number=3D"7"></div><div> </div></li><li><div data-line-=
number=3D"8"></div><div>  <span>// v1 : SESSION_COUNT=3D0|TIME_PE=
RIOD_1s_3s=3D0|TIME_PERIOD_4s_6s=3D0|STEP_PERIOD_1_3=3D0|STEP_PER=
IOD_4_6=3D0</span></div></li><li><div data-line-number=3D"9"></di=
v><div>  <span>// v2 : TIME_PERIOD_1s_3s</span></div></li><li><di=
v data-line-number=3D"10"></div><div>  <span>// return: SESSION_C=
OUNT=3D0|TIME_PERIOD_1s_3s=3D1|TIME_PERIOD_4s_6s=3D0|STEP_PERIOD_=
1_3=3D0|STEP_PERIOD_4_6=3D0</span></div></li><li><div data-line-n=
umber=3D"11"></div><div>  <span>// =D5=E2=C0=EF=D3=D0=C8=FD=D6=D6=
=C7=E9=BF=F6=A3=BA</span></div></li><li><div data-line-number=3D"=
12"></div><div>  <span>// 1=A1=A2=D7=EE=B3=A3=BC=FB=B5=C4=C7=E9=BF=
=F6=A1=A3v1 =3D =C9=CF=D2=BB=B4=CE=B5=C4=C0=DB=BC=C6=D6=B5=A3=ACv=
2 =3D =B4=AB=C8=EB=B5=C4=D2=BB=B8=F6=D7=D6=B6=CE</span></div></li=
><li><div data-line-number=3D"13"></div><div>  <span>// 2=A1=A2=C8=
=E7=B9=FB=D6=BB=D3=D0=D2=BB=B8=F6=B7=D6=C7=F8=A3=AC=D4=DA=BC=C6=CB=
=E3=BD=E1=CA=F8=B5=C4=CA=B1=BA=F2=A3=ACv1 =3D =BF=D5=A3=ACv2 =3D=20=
=B8=C3=B7=D6=C7=F8=B5=C4=C0=DB=BC=C6=D6=B5</span></div></li><li><=
div data-line-number=3D"14"></div><div>  <span>// 3=A1=A2=C8=E7=B9=
=FB=D6=BB=D3=D0=B6=E0=B8=F6=B7=D6=C7=F8=A3=AC=D4=DA=BC=C6=CB=E3=BD=
=E1=CA=F8=B5=C4=CA=B1=BA=F2=A3=ACv1 =3D =C4=B3=D2=BB=B8=F6=B7=D6=C7=
=F8=B5=C4=C0=DB=BC=C6=D6=B5=A3=ACv2 =3D =C4=B3=D2=BB=B8=F6=B7=D6=C7=
=F8=B5=C4=C0=DB=BC=C6=D6=B5=A3=A8v1=A1=A2v2=BF=C9=C4=DC=B3=C9=B6=D4=
=B3=F6=CF=D6=B6=E0=CA=FD=A3=A9</span></div></li><li><div data-lin=
e-number=3D"15"></div><div> </div></li><li><div data-line-number=3D=
"16"></div><div>  <span>def </span><span><span>add</span></span><=
span><span>(v1: String, v2: String)</span></span><span>: String <=
/span>=3D {</div></li><li><div data-line-number=3D"17"></div><div=
>    <span>// =B6=D4=D3=A6=B5=DA=B6=FE=D6=D6=C7=E9=BF=F6</span></=
div></li><li><div data-line-number=3D"18"></div><div>    <span>if=
</span> (v1.trim.size=3D=3D<span>0</span>) <span>return</span> <s=
pan>v2</span></div></li><li><div data-line-number=3D"19"></div><d=
iv> </div></li><li><div data-line-number=3D"20"></div><div>    <s=
pan>println</span><span>(s</span><span><span>"v1 =3D $v1; v2 =3D=20=
$v2"</span></span><span>)</span></div></li><li><div data-line-num=
ber=3D"21"></div><div>    val mapv1 =3D v1.split(<span>"\\|"</spa=
n>).map(x=3D&gt;(x.split(<span>"=3D"</span>)(<span>0</span>), x.s=
plit(<span>"=3D"</span>)(<span>1</span>))).toMap</div></li><li><d=
iv data-line-number=3D"22"></div><div> </div></li><li><div data-l=
ine-number=3D"23"></div><div>    val result =3D <span>if</span> (=
v2.split(<span>"\\|"</span>).size &gt; <span>1</span>) {</div></l=
i><li><div data-line-number=3D"24"></div><div>      <span>// =B6=D4=
=D3=A6=B5=DA=C8=FD=D6=D6=C7=E9=BF=F6=A3=A8=B7=D6=C7=F8=B5=C4=BD=E1=
=B9=FB=D7=F6=BA=CF=B2=A2=A3=A9</span></div></li><li><div data-lin=
e-number=3D"25"></div><div>      val mapv2 =3D v2.split(<span>"\\=
|"</span>).map(x=3D&gt;(x.split(<span>"=3D"</span>)(<span>0</span=
>), x.split(<span>"=3D"</span>)(<span>1</span>))).toMap</div></li=
><li><div data-line-number=3D"26"></div><div>      val result3 =3D=
 <span>for</span> ((key, value) &lt;- mapv1) yield {</div></li><l=
i><div data-line-number=3D"27"></div><div>        key + <span>"=3D=
"</span> + (mapv2(key).toInt + value.toInt)</div></li><li><div da=
ta-line-number=3D"28"></div><div>      }</div></li><li><div data-=
line-number=3D"29"></div><div>      result3.mkString(<span>"|"</s=
pan>)</div></li><li><div data-line-number=3D"30"></div><div>    }=
</div></li><li><div data-line-number=3D"31"></div><div>    <span>=
else</span> {</div></li><li><div data-line-number=3D"32"></div><d=
iv>      <span>// =B6=D4=D3=A6=B5=DA=D2=BB=D6=D6=C7=E9=BF=F6=A3=A8=
=D7=EE=B3=A3=BC=FB=B5=C4=C7=E9=BF=F6=A3=A9</span></div></li><li><=
div data-line-number=3D"33"></div><div>      val result1 =3D <spa=
n>for</span> ((key, value) &lt;- mapv1) yield {</div></li><li><di=
v data-line-number=3D"34"></div><div>        <span>if</span> (key=
=3D=3Dv2) key + <span>"=3D"</span> + (value.toInt+<span>1</span>)=
</div></li><li><div data-line-number=3D"35"></div><div>        <s=
pan>else</span> key + <span>"=3D"</span> + value</div></li><li><d=
iv data-line-number=3D"36"></div><div>      }</div></li><li><div=20=
data-line-number=3D"37"></div><div>      result1.mkString(<span>"=
|"</span>)</div></li><li><div data-line-number=3D"38"></div><div>=
    }</div></li><li><div data-line-number=3D"39"></div><div> </di=
v></li><li><div data-line-number=3D"40"></div><div>    result</di=
v></li><li><div data-line-number=3D"41"></div><div>  }</div></li>=
<li><div data-line-number=3D"42"></div><div> </div></li><li><div=20=
data-line-number=3D"43"></div><div>  <span>def </span><span><span=
>main</span></span><span><span>(args: Array[String])</span></span=
><span>: Unit </span>=3D {</div></li><li><div data-line-number=3D=
"44"></div><div>    val sparkConf =3D <span>new</span> SparkConf(=
).setAppName(<span>"CustomAccumulator"</span>).setMaster(<span>"l=
ocal[3]"</span>)</div></li><li><div data-line-number=3D"45"></div=
><div>    val sc =3D <span>new</span> SparkContext(sparkConf)</di=
v></li><li><div data-line-number=3D"46"></div><div>    sc.addJar(=
<span>"/home/spark/IdeaProjects/SparkSamples/out/artifacts/SparkS=
amples_jar/SparkSamples.jar"</span>)</div></li><li><div data-line=
-number=3D"47"></div><div>    sc.setLogLevel(<span>"WARN"</span>)=
</div></li><li><div data-line-number=3D"48"></div><div> </div></l=
i><li><div data-line-number=3D"49"></div><div>    val accum =3D s=
c.accumulator(<span>""</span>)(CustomAccumulator)</div></li><li><=
div data-line-number=3D"50"></div><div>    val rdd =3D sc.makeRDD=
(Array(<span>"TIME_PERIOD_1s_3s"</span>, <span>"TIME_PERIOD_4s_6s=
"</span>, <span>"STEP_PERIOD_1_3"</span>, <span>"STEP_PERIOD_4_6"=
</span>, <span>"SESSION_COUNT"</span>, <span>"TIME_PERIOD_1s_3s"<=
/span>, <span>"TIME_PERIOD_4s_6s"</span>, <span>"STEP_PERIOD_1_3"=
</span>, <span>"STEP_PERIOD_4_6"</span>, <span>"SESSION_COUNT"</s=
pan>))</div></li><li><div data-line-number=3D"51"></div><div>   =20=
rdd.foreach(x=3D&gt;{</div></li><li><div data-line-number=3D"52">=
</div><div>      accum.add(x)</div></li><li><div data-line-number=
=3D"53"></div><div>    })</div></li><li><div data-line-number=3D"=
54"></div><div>    println(accum.value)</div></li><li><div data-l=
ine-number=3D"55"></div><div>    sc.stop()</div></li><li><div dat=
a-line-number=3D"56"></div><div>  }</div></li><li><div data-line-=
number=3D"57"></div><div>}</div></li></ol><div data-title=3D"=B5=C7=
=C2=BC=BA=F3=B8=B4=D6=C6"></div></pre></div><p>&nbsp;</p><article=
><br></article><div>=C0=B4=D4=B4=A3=BA&nbsp;<a href=3D"https://bl=
og.csdn.net/u011115903/article/details/81347127">https://blog.csd=
n.net/u011115903/article/details/81347127</a></div><br></div></bo=
dy></html>=0A=0A=0A=0A=0A=0A=0A=0A=0A=0A=0A=0A=0A=0A

------=_Next_Part_0000427468.203--

------=_Next_Part_0001282404.226--

