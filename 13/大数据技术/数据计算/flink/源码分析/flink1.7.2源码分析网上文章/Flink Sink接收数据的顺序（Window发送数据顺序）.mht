From: WizMime<support@wiz.cn>
Subject: =?gb2312?B?RmxpbmsgU2lua73TytXK/b7dtcTLs9Dyo6hXaW5kb3e3osvNyv2+3cuz0PKjqQ==?=
Date: Date: Fri, 23 Jul 2021 05:54:34 +0800
MIME-Version: 1.0
Content-Type: multipart/related;
	type="multipart/alternative";
	boundary="----=_Next_Part_0001264263.329"

This is a multi-part message in MIME format.

------=_Next_Part_0001264263.329
Content-Type: multipart/alternative;
	boundary="----=_Next_Part_0000421421.290"


------=_Next_Part_0000421421.290
Content-Type: text/plain;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

This is a multi-part message in MIME format.

------=_Next_Part_0000421421.290
Content-Type: text/html;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML><html><head>=0D=0A<meta http-equiv=3D"Content-Type=
" content=3D"text/html; charset=3Dgb2312">=0A=0A=0A=0A=0A=0A=0A<t=
itle>Flink Sink=BD=D3=CA=D5=CA=FD=BE=DD=B5=C4=CB=B3=D0=F2=A3=A8Wi=
ndow=B7=A2=CB=CD=CA=FD=BE=DD=CB=B3=D0=F2=A3=A9</title>=0A    =0A<=
style id=3D"wiz_custom_css">html, .wiz-editor-body {font-size: 12=
pt;}.wiz-editor-body {font-family: Helvetica, 'Hiragino Sans GB',=
 '=E5=BE=AE=E8=BD=AF=E9=9B=85=E9=BB=91', 'Microsoft YaHei UI', Si=
mSun, SimHei, arial, sans-serif;line-height: 1.7;margin: 0 auto;p=
adding: 20px 16px;padding: 1.25rem 1rem;}.wiz-editor-body h1,.wiz=
-editor-body h2,.wiz-editor-body h3,.wiz-editor-body h4,.wiz-edit=
or-body h5,.wiz-editor-body h6 {margin:20px 0 10px;margin:1.25rem=
 0 0.625rem;padding: 0;font-weight: bold;}.wiz-editor-body h1 {fo=
nt-size:20pt;font-size:1.67rem;}.wiz-editor-body h2 {font-size:18=
pt;font-size:1.5rem;}.wiz-editor-body h3 {font-size:15pt;font-siz=
e:1.25rem;}.wiz-editor-body h4 {font-size:14pt;font-size:1.17rem;=
}.wiz-editor-body h5 {font-size:12pt;font-size:1rem;}.wiz-editor-=
body h6 {font-size:12pt;font-size:1rem;color: #777777;margin: 1re=
m 0;}.wiz-editor-body div,.wiz-editor-body p,.wiz-editor-body ul,=
.wiz-editor-body ol,.wiz-editor-body dl,.wiz-editor-body li {marg=
in:8px 0;}.wiz-editor-body blockquote,.wiz-editor-body table,.wiz=
-editor-body pre,.wiz-editor-body code {margin:8px 0;}.wiz-editor=
-body .CodeMirror pre {margin:0;}.wiz-editor-body ul,.wiz-editor-=
body ol {padding-left:32px;padding-left:2rem;}.wiz-editor-body ol=
.wiz-list-level1 > li {list-style-type:decimal;}.wiz-editor-body=20=
ol.wiz-list-level2 > li {list-style-type:lower-latin;}.wiz-editor=
-body ol.wiz-list-level3 > li {list-style-type:lower-roman;}.wiz-=
editor-body blockquote {padding: 0 12px;}.wiz-editor-body blockqu=
ote > :first-child {margin-top:0;}.wiz-editor-body blockquote > :=
last-child {margin-bottom:0;}.wiz-editor-body img {border:0;max-w=
idth:100%;height:auto !important;margin:2px 0;}.wiz-editor-body t=
able {border-collapse:collapse;border:1px solid #bbbbbb;}.wiz-edi=
tor-body td,.wiz-editor-body th {padding:4px 8px;border-collapse:=
collapse;border:1px solid #bbbbbb;min-height:28px;word-break:brea=
k-word;box-sizing: border-box;}.wiz-hide {display:none !important=
;}</style></head>=0A=0A<body class=3D"wiz-editor-body"  spellchec=
k=3D"false"><div></div><h1 style=3D"font-size: 2rem; color: rgb(3=
6, 41, 46);"><font><font>Flink Sink=BD=D3=CA=D5=CA=FD=BE=DD=B5=C4=
=CB=B3=D0=F2=A3=A8Window=B7=A2=CB=CD=CA=FD=BE=DD=CB=B3=D0=F2=A3=A9=
</font></font></h1><h2 style=3D"font-size: 1.5rem; color: rgb(36,=
 41, 46);"><font><font>=B8=C5=CA=F6</font></font></h2><ul style=3D=
"color: rgb(36, 41, 46);"><li><p><font><font>InternalTimerService=
Impl.processingTimeTimersQueue=B4=E6=B4=A2=D7=C5=CD=AC=D2=BB=B8=F6=
=B4=B0=BF=DA=D6=D0=CB=F9=D3=D0=BC=FC=A3=AC=C8=A1=B5=DA=D2=BB=B8=F6=
=BC=FC=A3=AC=B5=F7=D3=C3WindowOperator.onProcessingTime=BD=F8=D0=D0=
=B4=A6=C0=ED=A3=AC=B2=A2=B7=A2=CB=CD=B8=F8=BD=D3=CA=D5=C6=F7</fon=
t></font></p></li><li><p><font><font>InternalTimerServiceImpl.pro=
cessingTimeTimersQueue=BC=FC=B4=A6=C0=ED=B5=C4=CB=B3=D0=F2=CA=C7=A3=
=AC=CF=C8=B4=A6=C0=ED=B5=DA=D2=BB=B8=F6=A3=AC=C8=BB=BA=F3=D2=C0=B4=
=CE=B0=D1=D7=EE=BA=F3=D2=BB=B8=F6=D4=AA=CB=D8=B7=C5=B5=BD=B5=DA=D2=
=BB=B8=F6=D4=AA=CB=D8=BD=F8=D0=D0=B4=A6=C0=ED</font></font></p></=
li><li><p><font><font>Key=A3=AC=B4=A6=C0=ED=B5=C4=CB=B3=D0=F2=A3=AC=
=C8=E71 2 3 5 4=A3=AC=BD=AB=BB=E1=B1=E4=B3=C9</font></font></p><p=
re style=3D"font-size: 0.85rem; background-color: rgb(246, 248, 2=
50);"><code> 1=0A 4=0A 5=0A 3=0A 2=0A</code></pre></li><li><p><fo=
nt><font>=D4=AD=CA=BC=C2=EB=A3=BA</font><a href=3D"https://github=
.com/opensourceteams/flink-maven-scala" style=3D"color:rgb(3, 102=
, 214);text-decoration:none;"><font>https</font></a><font><span>&=
nbsp;</span>:<span>&nbsp;</span></font></font><a href=3D"https://=
github.com/opensourceteams/flink-maven-scala" style=3D"color:rgb(=
3, 102, 214);text-decoration:none;"><font><font>//github.com/open=
sourceteams/flink-maven-scala</font></font></a></p></li></ul><h2=20=
style=3D"font-size: 1.5rem; color: rgb(36, 41, 46);"><font><font>=
=CA=E4=C8=EB=CA=FD=BE=DD</font></font></h2><pre style=3D"font-siz=
e: 0.85rem; color: rgb(36, 41, 46); background-color: rgb(246, 24=
8, 250);"><code>1 2 1 3 2 5 4=0A</code></pre><h2 style=3D"font-si=
ze: 1.5rem; color: rgb(36, 41, 46);"><font><font>=D4=AD=CA=BC=C2=EB=
=B7=D6=CE=F6</font></font></h2><h3 style=3D"font-size: 1.25rem; c=
olor: rgb(36, 41, 46);"><font><font>RecordWriter.emit</font></fon=
t></h3><ul style=3D"color: rgb(36, 41, 46);"><li><p><font><font>=B5=
=B1WordCount=D6=D0=B5=C4=CA=FD=BE=DD=BE=AD=B9=FDOperator=A3=A8Sou=
rce=A3=ACFlatMap=A3=ACMap=A3=A9=B4=A6=C0=ED=BA=F3=A3=AC=CD=A8=B9=FD=
RecordWriter.emit=A3=A8=A3=A9=BA=AF=CA=FD=B7=A2=C9=E4=CA=FD=BE=DD=
</font></font></p></li><li><p><font><font>=B4=CB=CA=B1=B7=A2=D5=E2=
=D1=F9=B5=C4=CA=FD=BE=DD=B8=F1=CA=BD=B7=A2=CB=CD</font></font></p=
><pre style=3D"font-size: 0.85rem; background-color: rgb(246, 248=
, 250);"><code>WordWithCount(1,1)=0AWordWithCount(2,1)=0AWordWith=
Count(1,1)=0AWordWithCount(3,1)=0AWordWithCount(2,1)=0AWordWithCo=
unt(5,1)=0AWordWithCount(4,1)   =0A=0A</code></pre></li><li><p><f=
ont><font>WindowOperator.processElement=BB=E1=BD=D3=CA=D5=B2=A2=B4=
=A6=C0=ED</font></font></p></li></ul><pre style=3D"font-size: 0.8=
5rem; color: rgb(36, 41, 46); background-color: rgb(246, 248, 250=
);"><code>=0A	private void emit(T record, int[] targetChannels) t=
hrows IOException, InterruptedException {=0A		serializer.serializ=
eRecord(record);=0A=0A		boolean pruneAfterCopying =3D false;=0A	=09=
for (int channel : targetChannels) {=0A			if (copyFromSerializerT=
oTargetChannel(channel)) {=0A				pruneAfterCopying =3D true;=0A	=09=
	}=0A		}=0A=0A		// Make sure we don't hold onto the large interme=
diate serialization buffer for too long=0A		if (pruneAfterCopying=
) {=0A			serializer.prune();=0A		}=0A	}=0A=0A=0A</code></pre><h3=20=
style=3D"font-size: 1.25rem; color: rgb(36, 41, 46);"><font><font=
>WindowOperator.processElement=A3=A8StreamRecord=D4=AA=CB=D8=A3=A9=
</font></font></h3><ul style=3D"color: rgb(36, 41, 46);"><li><p><=
font><font>WindowOperator.processElement=A3=AC=B8=F8=C3=BF=D2=BB=B8=
=F6WordWithCount=A3=A81,1=A3=A9=D5=E2=D1=F9=B5=C4=D4=AA=CB=D8=B7=D6=
=C5=E4=B4=B0=BF=DA=A3=AC=D2=B2=BE=CD=CA=C7=C8=B7=C8=CF=C3=BF=B8=F6=
=D2=BB=B8=F6=D4=AA=CB=D8=CA=F4=D3=DA=C4=C4=D2=BB=B8=F6=B4=B0=BF=DA=
=A3=AC=D2=F2=CE=AA=D0=E8=D2=AA=B6=D4=CD=AC=D2=BB=B8=F6=B4=B0=BF=DA=
=B5=C4=CF=E0=CD=AC=BC=FC=BD=F8=D0=D0=BE=DB=BA=CF=B2=D9=D7=F7</fon=
t></font></p><pre style=3D"font-size: 0.85rem; background-color:=20=
rgb(246, 248, 250);"><code>final Collection&lt;W&gt; elementWindo=
ws =3D windowAssigner.assignWindows(=0A            element.getVal=
ue(), element.getTimestamp(), windowAssignerContext);=0A</code></=
pre></li><li><p><font><font>=B0=D1=B5=B1=C7=B0=D4=AA=CB=D8=D4=F6=BC=
=D3=B5=BD=D7=B4=CC=AC=D6=D0=B1=A3=B4=E6=A3=AC=CC=ED=BC=D3=BA=AF=CA=
=FD=D6=D0=D5=FD=C8=B7=CF=E0=CD=AC=BC=FC=BD=F8=D0=D0=BE=DB=BA=CF=B2=
=D9=D7=F7=A3=A8reduce=A3=A9=A3=AC=B6=D4=CD=AC=D2=BB=B8=F6=B4=B0=BF=
=DA=D6=D0=CF=E0=CD=AC=BC=FC=BD=F8=D0=D0=C7=F3=BA=CD=BE=CD=CA=C7=D4=
=DA=D5=E2=B8=F6=B7=BD=B7=A8=D6=D0=BD=F8=D0=D0=B5=C4</font></font>=
</p><pre style=3D"font-size: 0.85rem; background-color: rgb(246,=20=
248, 250);"><code>windowState.add(element.getValue());=0A</code><=
/pre></li><li><p><font><font>triggerContext.onElement=A3=A8elemen=
t=A3=A9=A3=AC=B6=D4=B5=B1=C7=B0=D4=AA=CB=D8=C9=E8=D6=C3=B4=A5=B7=A2=
=C6=F7=A3=AC=D2=B2=BE=CD=CA=C7=B5=B1=C7=B0=D4=AA=CB=D8=B5=C4=B4=B0=
=BF=DA=D4=DA=B8=C3=CA=B1=BC=E4=B5=E3=B4=A5=B7=A2=A3=A8=BD=E1=CA=F8=
=B5=C4=CA=B1=BC=E4=B5=E3=A3=A9=A3=AC=B0=D1=B5=B1=C7=B0=D4=AA=CB=D8=
=B5=C4=BC=FC=A3=AC=D4=F6=BC=D3=B5=BDInternalTimerServiceImpl.proc=
essingTimeTimersQueue=D6=D0=A3=AC=C3=BF=D2=BB=CC=F5=CA=FD=BE=DD=BB=
=E1=BC=D3=D2=BB=B4=CE=A3=AC=BC=D3=CD=EA=BA=F3=BB=E1=C8=A5=D6=D8=A3=
=AC=CF=E0=B5=B1=D3=DASet=A3=AC=B6=D4=CF=E0=CD=AC=B5=C4=BC=FC=B5=C4=
=B4=A6=C0=ED=A3=AC=BA=F3=C3=E6=B7=A2=CB=CD=B8=F8Sink=B5=C4=CA=FD=BE=
=DD=A3=AC=BE=CD=CA=C7=B1=E9=C0=FA=D5=E2=B8=F6=B4=A6=C0=EDTimeTime=
rsQueue=D6=D0=B5=C4=CA=FD=BE=DD=A3=AC=B5=B1=C8=BB=A3=AC=C3=BF=B4=CE=
=B7=A2=CB=CD=B5=DA=D2=BB=B8=F6=D4=AA=CB=D8=A3=AC=B7=A2=CB=CD=BA=F3=
=A3=AC=BB=E1=B0=D1=D7=EE=BA=F3=D2=BB=B8=F6=D4=AA=CB=D8=B7=C5=B5=BD=
=B5=DA=D2=BB=B8=F6=D4=AA=CB=D8</font></font></p><pre style=3D"fon=
t-size: 0.85rem; background-color: rgb(246, 248, 250);"><code>Tri=
ggerResult triggerResult =3D triggerContext.onElement(element);=0A=
</code></pre></li></ul><pre style=3D"font-size: 0.85rem; color: r=
gb(36, 41, 46); background-color: rgb(246, 248, 250);"><code>=0Ap=
ublic void processElement(StreamRecord&lt;IN&gt; element) throws=20=
Exception {=0A		final Collection&lt;W&gt; elementWindows =3D wind=
owAssigner.assignWindows(=0A			element.getValue(), element.getTim=
estamp(), windowAssignerContext);=0A=0A		//if element is handled=20=
by none of assigned elementWindows=0A		boolean isSkippedElement =3D=
 true;=0A=0A		final K key =3D this.&lt;K&gt;getKeyedStateBackend(=
).getCurrentKey();=0A=0A		if (windowAssigner instanceof MergingWi=
ndowAssigner) {=0A			MergingWindowSet&lt;W&gt; mergingWindows =3D=
 getMergingWindowSet();=0A=0A			for (W window: elementWindows) {=0A=
=0A				// adding the new window might result in a merge, in that=20=
case the actualWindow=0A				// is the merged window and we work w=
ith that. If we don't merge then=0A				// actualWindow =3D=3D win=
dow=0A				W actualWindow =3D mergingWindows.addWindow(window, new=
 MergingWindowSet.MergeFunction&lt;W&gt;() {=0A					@Override=0A=09=
				public void merge(W mergeResult,=0A							Collection&lt;W&gt;=
 mergedWindows, W stateWindowResult,=0A							Collection&lt;W&gt;=
 mergedStateWindows) throws Exception {=0A=0A						if ((windowAss=
igner.isEventTime() &amp;&amp; mergeResult.maxTimestamp() + allow=
edLateness &lt;=3D internalTimerService.currentWatermark())) {=0A=
							throw new UnsupportedOperationException("The end timestamp=
 of an " +=0A									"event-time window cannot become earlier th=
an the current watermark " +=0A									"by merging. Current wate=
rmark: " + internalTimerService.currentWatermark() +=0A									"=
 window: " + mergeResult);=0A						} else if (!windowAssigner.isE=
ventTime() &amp;&amp; mergeResult.maxTimestamp() &lt;=3D internal=
TimerService.currentProcessingTime()) {=0A							throw new Unsupp=
ortedOperationException("The end timestamp of a " +=0A									"p=
rocessing-time window cannot become earlier than the current proc=
essing time " +=0A									"by merging. Current processing time:=20=
" + internalTimerService.currentProcessingTime() +=0A									" w=
indow: " + mergeResult);=0A						}=0A=0A						triggerContext.key=20=
=3D key;=0A						triggerContext.window =3D mergeResult;=0A=0A			=09=
		triggerContext.onMerge(mergedWindows);=0A=0A						for (W m: mer=
gedWindows) {=0A							triggerContext.window =3D m;=0A							trig=
gerContext.clear();=0A							deleteCleanupTimer(m);=0A						}=0A=0A=
						// merge the merged state windows into the newly resulting=20=
state window=0A						windowMergingState.mergeNamespaces(stateWind=
owResult, mergedStateWindows);=0A					}=0A				});=0A=0A				// dro=
p if the window is already late=0A				if (isWindowLate(actualWind=
ow)) {=0A					mergingWindows.retireWindow(actualWindow);=0A					c=
ontinue;=0A				}=0A				isSkippedElement =3D false;=0A=0A				W sta=
teWindow =3D mergingWindows.getStateWindow(actualWindow);=0A				i=
f (stateWindow =3D=3D null) {=0A					throw new IllegalStateExcept=
ion("Window " + window + " is not in in-flight window set.");=0A=09=
			}=0A=0A				windowState.setCurrentNamespace(stateWindow);=0A		=09=
	windowState.add(element.getValue());=0A=0A				triggerContext.key=
 =3D key;=0A				triggerContext.window =3D actualWindow;=0A=0A			=09=
TriggerResult triggerResult =3D triggerContext.onElement(element)=
;=0A=0A				if (triggerResult.isFire()) {=0A					ACC contents =3D=20=
windowState.get();=0A					if (contents =3D=3D null) {=0A						con=
tinue;=0A					}=0A					emitWindowContents(actualWindow, contents)=
;=0A				}=0A=0A				if (triggerResult.isPurge()) {=0A					windowSt=
ate.clear();=0A				}=0A				registerCleanupTimer(actualWindow);=0A=
			}=0A=0A			// need to make sure to update the merging state in=20=
state=0A			mergingWindows.persist();=0A		} else {=0A			for (W win=
dow: elementWindows) {=0A=0A				// drop if the window is already=20=
late=0A				if (isWindowLate(window)) {=0A					continue;=0A				}=0A=
				isSkippedElement =3D false;=0A=0A				windowState.setCurrentNa=
mespace(window);=0A				windowState.add(element.getValue());=0A=0A=
				triggerContext.key =3D key;=0A				triggerContext.window =3D w=
indow;=0A=0A				TriggerResult triggerResult =3D triggerContext.on=
Element(element);=0A=0A				if (triggerResult.isFire()) {=0A					A=
CC contents =3D windowState.get();=0A					if (contents =3D=3D nul=
l) {=0A						continue;=0A					}=0A					emitWindowContents(window,=
 contents);=0A				}=0A=0A				if (triggerResult.isPurge()) {=0A		=09=
		windowState.clear();=0A				}=0A				registerCleanupTimer(window)=
;=0A			}=0A		}=0A=0A		// side output input event if=0A		// elemen=
t not handled by any window=0A		// late arriving tag has been set=
=0A		// windowAssigner is event time and current timestamp + allo=
wed lateness no less than element timestamp=0A		if (isSkippedElem=
ent &amp;&amp; isElementLate(element)) {=0A			if (lateDataOutputT=
ag !=3D null){=0A				sideOutput(element);=0A			} else {=0A				thi=
s.numLateRecordsDropped.inc();=0A			}=0A		}=0A	}=0A=0A=0A</code><=
/pre><h3 style=3D"font-size: 1.25rem; color: rgb(36, 41, 46);"><f=
ont><font>InternalTimerServiceImpl.onProcessingTime</font></font>=
</h3><ul style=3D"color: rgb(36, 41, 46);"><li><p><font><font>pro=
cessingTimeTimersQueue=A3=A8HeapPriorityQueueSet=A3=A9=B8=C3=B6=D4=
=CF=F3=D6=D0=B4=E6=B4=A2=C1=CB=CB=F9=D3=D0=B5=C4=BC=FC=A3=AC=D5=E2=
=D0=A9=BC=FC=CA=C7=C8=A5=D6=D8=BA=F3=A3=AC=B0=B4=B4=A6=C0=ED=CB=B3=
=D0=F2=C5=C5=D0=F2</font></font></p></li><li><p><font><font>proce=
ssingTimeTimersQueue.peek=A3=A8=A3=A9=CC=E1=C8=A1=B5=DA=D2=BB=CC=F5=
=CA=FD=BE=DD=BD=F8=D0=D0=B4=A6=C0=ED</font></font></p></li><li><p=
><font><font>processingTimeTimersQueue.poll=A3=A8=A3=A9;=BB=E1=BF=
=C9=C9=BE=B3=FD=B5=DA=D2=BB=CC=F5=CA=FD=BE=DD=A3=AC=B2=A2=C7=D2=A3=
=AC=C4=C3=D7=EE=BA=F3=D2=BB=CC=F5=CA=FD=BE=DD=A3=AC=B7=C5=B5=DA1=B8=
=F6=D4=AA=CB=D8=A3=AC=B5=BC=D6=C2=A3=AC=CB=F9=D3=D0=D4=AA=CB=D8=B5=
=C4=B4=A6=C0=ED=CB=B3=D0=F2=CA=C7=A3=AC=CF=C8=B4=A6=C0=ED=B5=DA=D2=
=BB=B8=F6=D4=AA=CB=D8=A3=AC=C8=BB=BA=F3=A3=AC=B0=D1=D7=EE=BA=F3=D2=
=BB=B8=F6=D4=AA=CB=D8=B7=C5=B5=DA=D2=BB=B8=F6=A3=AC=D7=EE=BA=F3=D2=
=BB=B8=F6=BE=CD=D6=C3=CE=AA=BF=D5=A3=AC=D4=D9=D1=AD=BB=B7=B4=A6=C0=
=ED=CB=F9=D3=D0=CA=FD=BE=DD=A3=AC=CF=E0=B5=B1=D3=DA=B4=A6=C0=ED=CD=
=EA=B5=DA=D2=BB=B8=F6=D4=AA=CB=D8=A3=AC=B4=A6=BA=F3=B4=D3=D7=EE=BA=
=F3=D2=BB=B8=F6=D4=AA=CB=D8=BF=AA=CA=BC=B4=A6=C0=ED=A3=AC=D2=BB=D6=
=B1=B4=A6=C0=ED=B5=BD=CD=EA=B3=C9=A3=AC=CC=E6=BB=BB</font></font>=
</p><pre style=3D"font-size: 0.85rem; background-color: rgb(246,=20=
248, 250);"><code>1 2 1 3 2 5 4=0A=B4=E6=CE=AA 1 2 3 5 4 =0A=CB=B3=
=D0=F2=BE=CD=B1=E4=CE=AA=0A 1=0A 4=0A 5=0A 3=0A 2=0A</code></pre>=
</li><li><p><font><font>keyContext.setCurrentKey=A3=A8timer.getKe=
y=A3=A8=A3=A9=A3=A9; //=C9=E8=D6=C3=B5=B1=C7=B0=B5=C4=BC=FC=A3=AC=
=B5=B1=C7=B0=D0=E8=D2=AA=B4=A6=C0=ED=B5=C4</font></font></p></li>=
<li><p><font><font>triggerTarget.onProcessingTime=A3=A8timer=A3=A9=
; //=B5=F7=D3=C3WindowOperator.onProcessingTime=A3=A8timer=A3=A9=B4=
=A6=C0=ED</font></font></p></li></ul><pre style=3D"font-size: 0.8=
5rem; color: rgb(36, 41, 46); background-color: rgb(246, 248, 250=
);"><code>queue =3D {HeapPriorityQueueElement[129]@8184} =0A 1 =3D=
 {TimerHeapInternalTimer@12441} "Timer{timestamp=3D1551505439999,=
 key=3D(1), namespace=3DTimeWindow{start=3D1551505380000, end=3D1=
551505440000}}"=0A 2 =3D {TimerHeapInternalTimer@12442} "Timer{ti=
mestamp=3D1551505439999, key=3D(2), namespace=3DTimeWindow{start=3D=
1551505380000, end=3D1551505440000}}"=0A 3 =3D {TimerHeapInternal=
Timer@12443} "Timer{timestamp=3D1551505439999, key=3D(3), namespa=
ce=3DTimeWindow{start=3D1551505380000, end=3D1551505440000}}"=0A=20=
5 =3D {TimerHeapInternalTimer@12443} "Timer{timestamp=3D155150543=
9999, key=3D(3), namespace=3DTimeWindow{start=3D1551505380000, en=
d=3D1551505440000}}"=0A 4 =3D {TimerHeapInternalTimer@12443} "Tim=
er{timestamp=3D1551505439999, key=3D(3), namespace=3DTimeWindow{s=
tart=3D1551505380000, end=3D1551505440000}}"=0A=0A</code></pre><u=
l style=3D"color: rgb(36, 41, 46);"><li><font><font>=B5=F7=D3=C3W=
indowOperator.onProcessingTime=A3=A8timer=A3=A9=B4=A6=C0=ED=B5=B1=
=C7=B0=BC=FC;</font></font></li></ul><pre style=3D"font-size: 0.8=
5rem; color: rgb(36, 41, 46); background-color: rgb(246, 248, 250=
);"><code>=0Apublic void onProcessingTime(long time) throws Excep=
tion {=0A		// null out the timer in case the Triggerable calls re=
gisterProcessingTimeTimer()=0A		// inside the callback.=0A		nextT=
imer =3D null;=0A=0A		InternalTimer&lt;K, N&gt; timer;=0A=0A		whi=
le ((timer =3D processingTimeTimersQueue.peek()) !=3D null &amp;&=
amp; timer.getTimestamp() &lt;=3D time) {=0A			processingTimeTime=
rsQueue.poll();=0A			keyContext.setCurrentKey(timer.getKey());=0A=
			triggerTarget.onProcessingTime(timer);=0A		}=0A=0A		if (timer=20=
!=3D null &amp;&amp; nextTimer =3D=3D null) {=0A			nextTimer =3D=20=
processingTimeService.registerTimer(timer.getTimestamp(), this);=0A=
		}=0A	}=0A</code></pre><h3 style=3D"font-size: 1.25rem; color: r=
gb(36, 41, 46);"><font><font>WindowOperator.onProcessingTime</fon=
t></font></h3><ul style=3D"color: rgb(36, 41, 46);"><li><font><fo=
nt>triggerResult.isFire=A3=A8=A3=A9//=B5=B1=C7=B0=D4=AA=CB=D8=B6=D4=
=D3=A6=B5=C4window=D2=D1=BE=AD=BF=C9=D2=D4=B7=A2=C9=E4=C1=CB=A3=AC=
=BC=B4=B9=FD=C1=CB=BD=E1=CA=F8=CA=B1=BC=E4</font></font></li><li>=
<font><font>windowState.get=A3=A8=A3=A9//=BB=F1=C8=A1=B5=B1=C7=B0=
=BC=FC=B6=D4=D3=A6=B5=C4=A3=A8key=A3=ACvalue=A3=A9=B4=CB=CA=B1=D2=
=D1=BE=AD=CA=C7=CF=E0=CD=AC=B5=C4=BC=FC=BE=DB=BA=CF=BA=F3=B5=C4=D6=
=B5</font></font></li><li><font><font>=B7=A2=B9=E2=B4=B0=BF=DA=C4=
=DA=C8=DD=A3=A8triggerContext.window=A3=AC=C4=BF=C2=BC=A3=A9; //=B7=
=A2=CB=CD=B8=F8Sink=BD=F8=D0=D0=B4=A6=C0=ED</font></font></li></u=
l><pre style=3D"font-size: 0.85rem; color: rgb(36, 41, 46); backg=
round-color: rgb(246, 248, 250);"><code>public void onProcessingT=
ime(InternalTimer&lt;K, W&gt; timer) throws Exception {=0A		trigg=
erContext.key =3D timer.getKey();=0A		triggerContext.window =3D t=
imer.getNamespace();=0A=0A		MergingWindowSet&lt;W&gt; mergingWind=
ows;=0A=0A		if (windowAssigner instanceof MergingWindowAssigner)=20=
{=0A			mergingWindows =3D getMergingWindowSet();=0A			W stateWind=
ow =3D mergingWindows.getStateWindow(triggerContext.window);=0A	=09=
	if (stateWindow =3D=3D null) {=0A				// Timer firing for non-exi=
stent window, this can only happen if a=0A				// trigger did not=20=
clean up timers. We have already cleared the merging=0A				// win=
dow and therefore the Trigger state, however, so nothing to do.=0A=
				return;=0A			} else {=0A				windowState.setCurrentNamespace(s=
tateWindow);=0A			}=0A		} else {=0A			windowState.setCurrentNames=
pace(triggerContext.window);=0A			mergingWindows =3D null;=0A		}=0A=
=0A		TriggerResult triggerResult =3D triggerContext.onProcessingT=
ime(timer.getTimestamp());=0A=0A		if (triggerResult.isFire()) {=0A=
			ACC contents =3D windowState.get();=0A			if (contents !=3D nul=
l) {=0A				emitWindowContents(triggerContext.window, contents);=0A=
			}=0A		}=0A=0A		if (triggerResult.isPurge()) {=0A			windowState=
.clear();=0A		}=0A=0A		if (!windowAssigner.isEventTime() &amp;&am=
p; isCleanupTime(triggerContext.window, timer.getTimestamp())) {=0A=
			clearAllState(triggerContext.window, windowState, mergingWindo=
ws);=0A		}=0A=0A		if (mergingWindows !=3D null) {=0A			// need to=
 make sure to update the merging state in state=0A			mergingWindo=
ws.persist();=0A		}=0A	}</code><br><div style=3D"color:gray;"><sm=
all>=C0=B4=D4=B4=A3=BA&nbsp;<a href=3D"https://github.com/opensou=
rceteams/flink-maven-scala/blob/master/md/miniCluster/flink-sink-=
order.md">https://github.com/opensourceteams/flink-maven-scala/bl=
ob/master/md/miniCluster/flink-sink-order.md</a></small></div></p=
re></body></html>=0A=0A=0A=0A=0A=0A=0A=0A=0A=0A

------=_Next_Part_0000421421.290--

------=_Next_Part_0001264263.329--

